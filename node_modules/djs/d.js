var nowjs = require('now');
var Db = require('mongodb').Db;
var Connection = require('mongodb').Connection;
var Server = require('mongodb').Server;

var server
exports.initialize = function (theServer) {
	server = theServer
	var everyone = nowjs.initialize(server, {socketio:{"log level": process.argv[2]}});
	
	var usercoll;
	var mediacoll;
	var db = new Db('djs', new Server("localhost", 27017, {}), {native_parser:false});
	db.open(function(err, conn) {
		db = conn;
		db.collection('userinfo', function(err, coll) {
			usercoll = coll;
		});
		db.collection('mediainfo', function(err, coll) {
			mediacoll = coll;
		});
	});
	
	everyone.now.SbroadcastMedia = function (mId) {
		var self = this
		usercoll.findOne({isKing: true}, function (err, doc) {
			if (doc.uId == self.user.clientId) {
				mediacoll.findOne({_id: mId}, function (err, doc) {
					everyone.now.CplayMedia(doc);
				});
			}
		});
	};
	
	everyone.now.SgetCurrentMedia = function () {
		
	}
	
	
	
	
	
	
}
